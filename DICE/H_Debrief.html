{{ block scripts }}
<!-- This script block contains JavaScript code to handle consent for the survey -->
<style>
    .missing-answer {
    background-color: #ffebee !important;
    border: 2px solid #f44336 !important;
    border-radius: 4px;
    padding: 8px;
    margin: 4px 0;
    animation: pulse-red 1s ease-in-out;
}

@keyframes pulse-red {
    0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); }
    100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
}

.missing-answer label,
.missing-answer .form-check-label {
    color: #d32f2f !important;
    font-weight: bold;
}

  /* If the field is a textarea or input text box */
  #id_understand_AI, /* assuming the rendered input has this id */
  input[name="understand_AI"],
  textarea[name="understand_AI"] {
      font-size: 1.5rem;       /* larger text */
    padding: 10px 15px;          /* more padding */
    border: 2px solid #007bff;   /* blue border */
    border-radius: 8px;          /* rounded corners */
    box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);  /* subtle glow */
    width: 100%;                 /* full width */
    max-width: 600px;            /* limit max width */
    display: block;
    margin: 10px auto 20px auto; /* center and spacing */
  }

  /* Optionally add focus effect */
  #id_understand_AI:focus,
  input[name="understand_AI"]:focus,
  textarea[name="understand_AI"]:focus {
    border-color: #0056b3;
    box-shadow: 0 0 12px rgba(0, 86, 179, 0.7);
    outline: none;
  }
  body {
  /*background: linear-gradient(135deg, #e0f7fa, #ffffff);*/
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: #222;
  line-height: 1.6;
  padding: 20px;
}

/*.card {*/
/*  max-width: 700px;*/
/*  margin: 40px auto;*/
/*  border-radius: 15px;*/
/*  box-shadow: 0 8px 20px rgba(0,0,0,0.1);*/
/*  background-color: #fff;*/
/*}*/

h1, h2, h3 {
  font-weight: 600;
  /*color: #0056b3;*/
  margin-bottom: 1rem;
}

h1.display-4 {
  font-size: 1.5rem;
  margin-bottom: 1rem;
}

p {
  font-size: 1.5rem;
  margin-bottom: 1rem;
}

ul {
  font-size: 1.5rem;
  margin-bottom: 1rem;
  list-style-type: disc;
}

a {
  color: #007bff;
  text-decoration: none;
}

a:hover, a:focus {
  color: #0056b3;
  text-decoration: underline;
}

#treatment-image {
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  margin-bottom: 1.5rem;
}

.form-check-label {
    font-size: 1.5rem;
}

#messageDiv {
  color: #d9534f;  /* Bootstrap danger red */
  font-weight: 600;
  margin-top: 10px;
  margin-bottom: 15px;
  text-align: center;
}

/*button#submitButton {*/
/*  background-color: #007bff;*/
/*  border: none;*/
/*  padding: 12px 30px;*/
/*  font-size: 1.125rem;*/
/*  border-radius: 6px;*/
/*  color: white;*/
/*  cursor: pointer;*/
/*  transition: background-color 0.3s ease;*/
/*  display: block;*/
/*  margin: 20px auto 0;*/
/*  min-width: 180px;*/
/*}*/

button#submitButton:disabled {
  background-color: #6c757d;
  cursor: not-allowed;
}

table.table {
  margin-top: 2rem;
  margin-bottom: 2rem;
}

@media (max-width: 768px) {
  .card {
    margin: 20px 15px;
  }
}

  .form-group {
  margin-bottom: 1.5rem;
}

.form-check {
  margin-bottom: 0.8rem;
}

.form-check-label {
  font-size: 1.5rem;
}

label[for="id_understand_AI"] {
  font-size: 1.5rem;  /* match the paragraph font size */
  font-weight: 600;   /* optional, to emphasize */
  display: block;
  margin-bottom: 0.5rem;
}

  /* Submit button container */
  .submit-container {
    display: flex;
    justify-content: flex-end;
    margin-top: 30px;
  }

  button[type="submit"] {
    background-color: #2c7be5;
    color: white;
    border: none;
    padding: 10px 22px;
    font-size: 1.3rem;
    font-weight: 700;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 5px 10px rgba(44,123,229,0.4);
    transition: background-color 0.25s ease;
  }

  button[type="submit"]:hover {
    background-color: #1a5fd9;
  }
  /* Red box styling for the question text container */
.missing-answer-redbox {
  border: 2px solid #f44336 !important;
  border-radius: 6px;
  padding: 10px;
  background-color: #ffebee;
  animation: pulse-red 1s ease-in-out;
  margin-bottom: 10px;
}

</style>

<style>
  /* Add a red error style for the consent paragraph */
  p.consent-label-error {
    color: #d9534f; /* Bootstrap red */
    font-weight: 700;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const submitButton = document.getElementById('submitButton');
  const consentGroup = document.getElementById('consent-group');
  const radios = document.querySelectorAll('input[name="consentdebrief"]');
  const understandAIContainer = document.getElementById('understand_AI_container');
  const understandAITextarea = document.getElementById('id_understand_AI');

  // Get the disclaimer from the template
  const disclaimer = "{{ disclaimer }}".toLowerCase().trim();

  // Remove error highlight on input/change
  radios.forEach(radio => {
    radio.addEventListener('change', () => {
      consentGroup.classList.remove('missing-answer');
    });
  });

  understandAITextarea.addEventListener('input', () => {
    if (understandAITextarea.value.trim()) {
      understandAIContainer.classList.remove('missing-answer-redbox');
    }
  });

// Function to validate the understand_AI text
function validateUnderstandAI(text) {
  // Normalize: lowercase, replace multiple spaces/dashes with single space
  const normalized = text.toLowerCase().replace(/[\s-]+/g, ' ').trim();

  // Build acceptable name patterns based on disclaimer
  let namePattern;

  const disclaimerLower = disclaimer.toLowerCase();

  if (disclaimerLower === 'kamala harris') {
    // Accept: Kamala Harris, Kamala, or Harris
    namePattern = '(?:kamala harris|kamala|harris)';
  } else if (disclaimerLower === 'donald trump') {
    // Accept: Donald Trump, Donald, or Trump
    namePattern = '(?:donald trump|donald|trump)';
  } else if (disclaimerLower === 'taylor swift and donald trump') {
    // Accept: full names, first names only, or last names only
    namePattern = '(?:taylor swift and donald trump|taylor and donald|swift and trump)';
  } else if (disclaimerLower === 'donald trump and elon musk') {
    // Accept: full names, first names only, or last names only
    namePattern = '(?:donald trump and elon musk|donald and elon|trump and musk)';
  } else if (disclaimerLower === 'charlie kirk') {
    // Accept: Charlie Kirk, Charlie, or Kirk
    namePattern = '(?:charlie kirk|charlie|kirk)';
  } else if (disclaimerLower === 'chuck schumer and hakeem jeffries') {
    // Accept: full names, first names only, or last names only
    namePattern = '(?:chuck schumer and hakeem jeffries|chuck and hakeem|schumer and jeffries)';
  } else if (disclaimerLower === 'chuck schumer') {
    // Accept: Chuck Schumer, Chuck, or Schumer
    namePattern = '(?:chuck schumer|chuck|schumer)';
  } else if (disclaimerLower === 'zohran mamdani') {
    // Accept: Zohran Mamdani, Zohran, or Mamdani
    namePattern = '(?:zohran mamdani|zohran|mamdani)';
  } else if (disclaimerLower === 'andrew cuomo') {
    // Accept: Andrew Cuomo, Andrew, or Cuomo
    namePattern = '(?:andrew cuomo|andrew|cuomo)';
  } else {
    // Fallback: use the disclaimer as-is
    namePattern = disclaimer.replace(/\s+/g, '\\s+');
  }

  // Expected pattern: "the image about [name] is ai-generated" or "ai generated" or "ai gen"
  const pattern = new RegExp(
    `^the image (?:of|about) ${namePattern} is ai[\\s-]?(?:generated|gen)\\.?$`,
    'i'
  );

  return pattern.test(normalized);
}

  submitButton.addEventListener('click', (e) => {
    e.preventDefault();

    let missingQuestions = [];

    // Check understand_AI textarea with matching validation
    const userText = understandAITextarea.value.trim();
    if (!userText) {
      missingQuestions.push("Understanding question - please type the required sentence");
      understandAIContainer.classList.add('missing-answer-redbox');
    } else if (!validateUnderstandAI(userText)) {
      missingQuestions.push("Understanding question - the text you entered does not match the required sentence");
      understandAIContainer.classList.add('missing-answer-redbox');
    } else {
      understandAIContainer.classList.remove('missing-answer-redbox');
    }

    // Check consent radios
    const consentSelected = document.querySelector('input[name="consentdebrief"]:checked');
    if (!consentSelected) {
      missingQuestions.push("Consent confirmation");
      consentGroup.classList.add('missing-answer');
    } else {
      consentGroup.classList.remove('missing-answer');
    }

    if (missingQuestions.length > 0) {
      alert("Please answer the following question(s) before submitting:\n- " + missingQuestions.join("\n- "));

      // Scroll to the first missing question
      const elementsInOrder = [
        { missing: !userText || !validateUnderstandAI(userText), element: understandAITextarea },
        { missing: !consentSelected, element: consentGroup }
      ];

      const firstUnanswered = elementsInOrder.find(item => item.missing);
      if (firstUnanswered) {
        firstUnanswered.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      return;
    }

    // If all validated, submit the form
    e.target.form.submit();
  });
});
</script>

{{ endblock }}

{{ block global_styles  }}
<!-- This block includes global style sheets -->
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
{{ endblock }}

{{ block content }}
<!-- This block contains HTML content for the main page -->
    <!-- Body with a background gradient -->
<!--<body class="bg-light.bg-gradient">-->

<div class="card mt-5 shadow-lg p-4">
    <div class="card-body">
        <!-- Centered Heading -->
        <div class="text=center">
            <h1 class="display-4 text-center fs-6">
              RESEARCH PARTICIPANT POST-SESSION CONSENT FORM
            </h1>
            <p class="text-center fs-6">
              User Engagement with Social Media Posts<br>
              Dr. Kaylyn Jackson Schiff, Dr. Daniel Schiff, Dr. JP Messina, Dr. Natalia Bueno<br>
              Department of Political Science, Emory University and Purdue University
            </p>

        </div>

<form method="post">

        <p class="lead">
<!--            <Large>-->
                <p><strong>To continue to the end of the survey, please confirm or withdraw your consent at the bottom of this page.</strong></p>

                <p>Thank you for participating in this study. This study involved deception. This means that we did not provide you with the complete description of the purpose of the study and some of the methods or instruments used had a different purpose than how we described them. Deception is used in research when knowledge of the purpose of the study or certain aspects of the study may bias participant responses. Deception involves either false information—a “cover story”—or omission of certain information. The purpose of this form is to explain the true purpose of the study and/or provide information that had been omitted. You also will be asked permission to use the information we obtained from you during your participation.</p><br>

                <p> You were told that the study was about your opinions on social media. <strong>Our research actually focuses on deepfakes.</strong> Deepfakes are inauthentic content (including video, audio, and visual content) created and/or altered by generative machine learning models or other artificial intelligence (AI) techniques. We are interested in whether putting labels or watermarks on deepfakes can improve individuals’ ability to distinguish between AI-generated and authentic content.<br></p>

                <p> To obtain unbiased or natural reactions, we had to give you some false information during the study. In particular, the post below that you saw during the study is in fact AI-generated. </p>

                <div style="display: flex; justify-content: center; margin: 20px auto;">
    <img src="{{ image_screenshot_nowatermark }}" id="treatment-image" alt="Screenshot"
         style="max-width: 100%; width: 100%; max-width: 600px; cursor: crosshair;">
</div>

<!-- Reduced top margin for this div -->
<div style="text-align: center; margin: -30px auto 10px auto;">
  <p style="margin: 0;"><strong>THE IMAGE IN THIS POST IS AI-GENERATED.</strong></p>
</div>

<!-- Optional: tighten this spacing too if needed -->
<p style="margin-top: 4px;">
  This was necessary for us to better understand natural reactions to deepfakes. When designing this study, we took care to minimize any possible risks or discomforts that might be related to the deception.
</p>

<div id="understand_AI_container" style="text-align: center; margin: 20px auto;">
  <label for="id_understand_AI" class="form-label" style="display: inline-block;">
    To make sure you understand this message, please type the following sentence:
    <strong>The image about {{ disclaimer }} is AI-generated.</strong>
  </label>
</div>

<textarea name="understand_AI" id="id_understand_AI" rows="4" class="form-control"></textarea>

                <p> <strong>Some tips for recognizing deepfakes generated with AI include looking for:</strong></p>
                <ul>
                    <li>Missing or extra fingers or hands that are deformed in some way</li>
                    <li>Small details in faces that are distorted</li>
                    <li>Misspelled text in the images</li>
                    <li>Inconsistent reflections</li>
                </ul>

        <p>In addition, apply media literacy skills:</p>
        <ul>
                    <li><strong>Pause and reflect:</strong> Ask who created the content and why</li>
                    <li><strong>Check the source:</strong> Is it a reputable outlet or an unknown outlet?</li>
                    <li><strong>Cross-verify:</strong> Search for the same story or image across multiple credible sources</li>
                    <li><strong>Analyze tone and language:</strong> Be wary of sensational, emotionally charged, or divise language</li>
                    <li><strong>Consider context:</strong> Images and videos can be taken out of context to mislead</li>

        </ul>

                <p> None of these techniques are foolproof, especially as AI-generated content becomes more sophisticated. <strong>Additional resources about deepfakes:</strong><br> </p>

                <ul>
<li>
  <a href="https://apnews.com/article/one-tech-tip-spotting-deepfakes-ai-8f7403c7e5a738488d74cf2326382d8c" target="_blank" rel="noopener noreferrer">
    AP News: How to spot AI-generated deepfake images
  </a>
</li>

<li>

  <a href="https://hivemoderation.com/ai-generated-content-detection" target="_blank" rel="noopener noreferrer">
    Download the Hive Moderation AI-generated content detection browser extension
  </a>
</li>

                    <li>

  <a href="https://newslit.org/educators/resources/breaking-news-checklist/" target="_blank" rel="noopener noreferrer">
    News Literacy Project: Breaking News Checklist
  </a>
</li>

                </ul>

                <p>Now that you understand the true nature of our study, you have the chance to refuse the use of the data we collected from you for research purposes. You are free to ask us not to use your data in our study analysis. If you decline to let us use your data, you will still receive compensation just as you would if we use your data in our analysis. This is entirely voluntary, but we hope to analyze as much data as possible to better understand solutions to the problem of disinformation due to deepfakes.</p>

                <p>Because this experiment is ongoing, we request that you not share the true nature and purpose of this experiment with others who might potentially participate in our study.</p>

                <p><strong>Who can I contact if I have questions about the study?</strong></p>

                <p>If you have questions, comments or concerns about this research project, you can talk to one of the researchers.  Please contact Dr. Kaylyn Jackson Schiff (+1 765-494-4161), the principal investigator.

If you have questions about your rights while taking part in the study or have concerns about the treatment of research participants, please call the Human Research Protection Program at (765) 494-5942, email (irb@purdue.edu) or write to:
Human Research Protection Program - Purdue University
Ernest C. Young Hall, Room 1010
155 S. Grant St.,
West Lafayette, IN 47907-2114

</p>

<p style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Documentation of Informed Consent</strong></p>

<div id="consent-group">
  <table class="table table-responsive" style="margin-top: 0.5rem;">
    <tbody>
      <tr>
        <th scope="row"> </th>
        <td>
          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" name="consentdebrief" id="consentdebriefYes" value="yes">
            <label class="form-check-label" for="consentdebriefYes">
              I have had the opportunity to read this consent form and have the research study more fully explained, including the need for and use of deception.
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="consentdebrief" id="consentdebriefNo" value="no">
            <label class="form-check-label" for="consentdebriefNo">
              No, I do not give permission for the researchers to use my anonymous survey responses. Please discard the data you obtained from me.
            </label>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="submit-container">
  <button type="submit" id="submitButton" aria-label="Submit survey responses">
    ➔
  </button>
</div>
    </form>
    </div>
</div>
{{ endblock }}
