{% block title %}
    <!-- Your Page Title -->
<!--    Demographics-->
{% endblock %}

{% block content %}

<div class="survey-container">
  <form method="post">


<style>
  /* ===== Base Styles ===== */
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    color: #222;
    background-color: #f9f9f9;
    margin: 0;
    padding: 0;
  }

  .survey-container {
    max-width: 1400px;
    margin: 40px auto;
    background: white;
    padding: 30px 40px;
    border-radius: 6px;
    box-shadow: 0 0 12px rgba(0, 0, 0, 0.08);
  }

  p {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .question-label {
    font-size: 1.3rem;
    font-weight: 600;
    color: #222;
  }
  .form-field {
  margin-bottom: 40px; /* or more if you want more space */
}

  /* ===== Radio Button Container Styling (FIX FOR MOBILE) ===== */
  .form-group div {
    display: flex;
    align-items: flex-start;
    margin-bottom: 12px;
    gap: 8px;
  }

  .form-group input[type="radio"] {
    flex-shrink: 0;
    margin: 0;
    margin-top: 2px; /* Slight adjustment to align with first line of text */
  }

  .form-group label {
    flex: 1;
    font-size: 1rem;
    font-weight: 400;
    color: #333;
    line-height: 1.4;
    cursor: pointer;
    margin: 0;
  }

  /* ===== Table Styles ===== */
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 18px;
    margin-bottom: 40px;
  }

  th, td {
    padding: 12px;
    text-align: center;
    vertical-align: middle;
    font-size: 0.95rem;
    color: #333;
  }

  th {
    font-weight: 600;
    background: #f1f1f1;
    border-bottom: 2px solid #ddd;
  }

  /* Question Column */
  .question-column {
    width: 20%;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: break-word;
    text-align: left;
    font-weight: 600;
    color: #222;
  }
  /* ===== Slider Styles ===== */
  .slider-container {
    position: relative;
    width: 100%;
    margin-bottom: 60px;
    padding: 0;
  }

  .slider {
    width: 100%;
    height: 14px;
    background: #ddd;
    border-radius: 7px;
    margin-bottom: 40px;
    appearance: none;
    outline: none;
  }

  .slider-value {
    text-align: center;
    font-size: 1.3rem;
    font-weight: 600;
    color: #444;
    margin-top: -20px;
  }

  .slider-labels {
    position: relative;
    height: 80px;
    width: 100%;
    user-select: none;
  }

  .slider-labels span {
    position: absolute;
    top: 0;
    transform: rotate(60deg) translateY(6px);
    transform-origin: top center;
    font-size: 0.8rem;
    white-space: nowrap;
    text-align: center;
  }

  /* Position slider labels */
  .slider-labels span:nth-child(1) { left: 0%; }
  .slider-labels span:nth-child(2) { left: 16.666%; }
  .slider-labels span:nth-child(3) { left: 33.333%; }
  .slider-labels span:nth-child(4) { left: 50%; }
  .slider-labels span:nth-child(5) { left: 66.666%; }
  .slider-labels span:nth-child(6) { left: 83.333%; }
  .slider-labels span:nth-child(7) { left: 90%; }


  /* ----- Matrix Table Specific Styles ----- */
  .matrix-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 40px;
    table-layout: auto;
  }

  .matrix-table th,
  .matrix-table td {
    border: 1px solid #ddd;
    padding: 10px 8px;
    text-align: center;
    vertical-align: middle;
    font-size: 1rem;
    color: #333;
  }

  .matrix-table .question-column {
    max-width: 30%; /* wider for question text */
    white-space: normal;
    word-break: normal;
    overflow-wrap: normal;
    text-align: left;
    font-weight: 600;
    color: #222;
  }

  /* Radio Answer Columns */
  .matrix-table th:not(:first-child),
  .matrix-table td:not(.question-column) {
    padding: 4px 2px;
    font-size: 0.85rem;
    word-break: normal;
    text-align: center;
  }

  /* Radio Inputs */
  .matrix-table input[type="radio"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
  }

  /* Hide mobile labels on desktop */
  .matrix-table td label.mobile-label {
    display: none;
  }

  /* Wrapper for horizontal scroll on small screens */
  .matrix-wrapper {
    overflow-x: auto;
    width: 100%;
  }

  .matrix-wrapper {
    overflow-x: hidden;
    width: 100%;
  }

  /* ===== ERROR STYLING (matching other pages) ===== */
  /* Validation highlighting styles */
  .missing-answer {
    background-color: #ffebee !important;
    border: 2px solid #f44336 !important;
    border-radius: 4px;
    padding: 8px;
    margin: 4px 0;
    animation: pulse-red 1s ease-in-out;
  }

  .missing-answer .question-column {
    color: #d32f2f !important;
    font-weight: bold;
  }

  .missing-answer .question-label {
    color: #d32f2f !important;
    font-weight: bold;
  }

  .missing-answer p {
    color: #d32f2f !important;
    font-weight: bold;
  }

  .missing-answer > label {
    color: #d32f2f !important;
    font-weight: bold;
  }

  /* Special styling for matrix table rows with missing answers */
  .missing-answer-row {
    background-color: #ffebee !important;
    animation: pulse-red 1s ease-in-out;
  }

  .missing-answer-row td {
    background-color: #ffebee !important;
    border: 1px solid #f44336 !important;
  }

  .missing-answer-row .question-column {
    color: #d32f2f !important;
    font-weight: bold;
  }

  @keyframes pulse-red {
    0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); }
    100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
  }

  /* Submit button container */
  .submit-container {
    display: flex;
    justify-content: flex-end;
    margin-top: 30px;
  }

  button[type="submit"] {
    background-color: #2c7be5;
    color: white;
    border: none;
    padding: 10px 22px;
    font-size: 1.3rem;
    font-weight: 700;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 5px 10px rgba(44,123,229,0.4);
    transition: background-color 0.25s ease;
  }

  button[type="submit"]:hover {
    background-color: #1a5fd9;
  }

  /* ===== Responsive ===== */
  @media (max-width: 700px) {
    .survey-container {
      margin: 15px;
      padding: 20px;
    }
    /* Constrain dropdown widths */
.form-field select {
  max-width: 400px;
  width: 100%;
}

/* On mobile, allow full width */
@media (max-width: 700px) {
  .form-field select {
    max-width: 100%;
  }
}

    /* Mobile Radio Button Fixes */
    .form-group div {
      margin-bottom: 15px;
      gap: 10px;
    }

    .form-group label {
      font-size: 0.9rem;
      line-height: 1.3;
    }

    .form-group input[type="radio"] {
      width: 18px;
      height: 18px;
      margin-top: 1px;
    }

    .slider-labels span {
      font-size: 0.6rem;
    }

    p, .slider-value {
      font-size: 1rem;
    }

    .slider-container {
      padding: 0;
    }

    .matrix-table th,
    .matrix-table td {
      font-size: 0.75rem;
      padding: 6px;
    }

    .matrix-table {
      width: 100%;
      table-layout: fixed;
    }

    .question-label {
      font-size: 1rem;
    }

    /* Slightly wider question column */
    .matrix-table .question-column {
      width: 50%;             /* Give more space for questions */
      font-size: 0.5rem;
      padding-left: 1px;
      padding-right: 1px;
      word-break: break-word;
      white-space: normal;
    }

    /* Make radio columns narrow */
    .matrix-table th:not(:first-child),
    .matrix-table td:not(.question-column) {
      max-width: 1px;
      white-space: normal;
      word-break: break-word;
      padding: 0px 0px;
      font-size: 0.6rem;
    }
  }

</style>

<div class="form-field" id="age-field">
  <label class="question-label" for="age">
    What is your age?
  </label>
  {{ form.age }}
</div>

<div class="form-field" id="gender-field">
  <label class="question-label" for="gender">
    What is your gender?
  </label>
  {{ form.gender }}
</div>

<div class="form-field" id="state-field">
  <label class="question-label" for="state">
    What state do you live in?
  </label>
  {{ form.state }}
</div>

<div class="form-field" id="race-field">
  <label class="question-label" for="race">
    Choose the group listed below that best captures what you consider yourself to be.
  </label>
  {{ form.race }}
</div>

<div class="form-field" id="education-field">
  <label class="question-label" for="education">
    What is the highest level of education that you have completed?
  </label>
  {{ form.education }}
</div>

<div class="form-field" id="income-field">
  <label class="question-label" for="income">
    What is your current annual household income before taxes?
  </label>
  {{ form.income }}
</div>

<div class="submit-container">
  <button type="submit" id="submitButton" aria-label="Submit survey responses" onclick="return validateForm()">
    ➔
  </button>
</div>

  </form>
</div>

<script>
// Enhanced validation function with highlighting and detailed messages
function validateForm() {
  console.log('validateForm() called');

  // Define field names with their user-friendly labels
  const requiredFields = {
    'age': 'Your age',
    'gender': 'Your gender',
    'state': 'What state you live in',
    'race': 'Your race',
    'education': 'Your highest level of education',
    'income': 'Your combined household income'
  };

  const form = document.querySelector('form');
  if (!form) {
    console.log('Form not found');
    return true; // Let it submit if we can't find form
  }

  let unansweredFields = [];
  let missingElements = [];

  // Clear any previous highlighting
  document.querySelectorAll('.missing-answer').forEach(el => {
    el.classList.remove('missing-answer');
  });

  // Check each required field and collect missing ones
  Object.keys(requiredFields).forEach(function(fieldName) {
    let isAnswered = false;

    // Check if it's a radio button group
    const radioInputs = form.querySelectorAll(`input[name="${fieldName}"][type="radio"]`);
    if (radioInputs.length > 0) {
      // It's a radio group - check if any is selected
      const checked = form.querySelector(`input[name="${fieldName}"]:checked`);
      isAnswered = checked !== null;
    } else {
      // It's likely a select dropdown or text input
      const field = form.querySelector(`select[name="${fieldName}"], input[name="${fieldName}"]`);
      if (field) {
        if (field.type === 'text' || field.type === 'email' || field.tagName === 'TEXTAREA') {
          isAnswered = field.value.trim() !== '';
        } else if (field.tagName === 'SELECT') {
          isAnswered = field.value !== '' && field.value !== null;
        }
      }
    }

    if (!isAnswered) {
      unansweredFields.push(requiredFields[fieldName]);

      // Find and highlight the question container
      const fieldContainer = document.getElementById(`${fieldName}-field`);
      if (fieldContainer) {
        fieldContainer.classList.add('missing-answer');
        missingElements.push(fieldContainer);
      }
    }
  });

  if (unansweredFields.length > 0) {
    console.log('Validation failed. Unanswered fields:', unansweredFields);

    // Create detailed error message
    let message = 'Please answer the following question';
    if (unansweredFields.length > 1) {
      message += 's';
    }
    message += ' before submitting:\n\n';

    unansweredFields.forEach(function(fieldLabel, index) {
      message += '• ' + fieldLabel;
      if (index < unansweredFields.length - 1) {
        message += '\n';
      }
    });

    alert(message);

    // Scroll to first missing question
    if (missingElements.length > 0) {
      missingElements[0].scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });
    }

    return false; // Prevent form submission
  }

  console.log('Validation passed');
  return true; // Allow form submission
}

// Backup: Also try the event listener approach
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, setting up additional event listeners...');

  const forms = document.querySelectorAll('form');
  forms.forEach(function(form) {
    // Try to intercept with capturing phase
    form.addEventListener('submit', function(e) {
      console.log('Event listener caught submit');
      if (!validateForm()) {
        e.preventDefault();
        e.stopImmediatePropagation();
        return false;
      }
    }, true); // Use capturing phase
  });
});

// Also try intercepting all clicks on submit elements
document.addEventListener('click', function(e) {
  if (e.target && (e.target.type === 'submit' || e.target.getAttribute('type') === 'submit')) {
    console.log('Submit element clicked, validating...');
    if (!validateForm()) {
      e.preventDefault();
      e.stopImmediatePropagation();
      return false;
    }
  }
}, true);

// Optional: Add real-time validation feedback
function addRealTimeValidation() {
  const form = document.querySelector('form');
  if (!form) return;

  // Add change listeners to all form inputs
  const allInputs = form.querySelectorAll('input, select, textarea');
  allInputs.forEach(function(input) {
    input.addEventListener('change', function() {
      // Remove highlighting when question is answered
      const container = this.closest('.form-field');
      if (container && container.classList.contains('missing-answer')) {
        container.classList.remove('missing-answer');
      }
    });
  });
}

// Initialize real-time validation when DOM is ready
document.addEventListener('DOMContentLoaded', addRealTimeValidation);
</script>


{% endblock %}